#!/bin/bash

err=0
trap "err=1" ERR

source private/config
if [[ "$OfflineMode" != "y" ]]; then
  if [[ "$UseSavedCerts" != "y" ]]; then
    certbot --non-interactive --agree-tos --email $EMAIL --apache --domains $TRYITONLINENET,$TIORUN --redirect
  else
    certbot --staging --non-interactive --agree-tos --email $EMAIL --apache --domains $TRYITONLINENET,$TIORUN --redirect
    tar xvf private/letsencrypt.tar.gz -C /
    systemctl restart tio-web
  fi
fi

exit "$err"
